# [DESKTOP → JARVIS] 프로젝트 초기 보고 (PLAN)

```json
{
  "sender": "desktop",
  "type": "PLAN",
  "project_id": "PSD_figma",
  "thread_id": "INIT-001",
  "timestamp": "2026-02-06T12:00:00+09:00",
  "content": "아래 참조",
  "next_action": "자비스는 이 보고를 바탕으로 WBS를 작성하고 첫 번째 TASK 티켓을 발행해주세요"
}
```

---

## 1. 프로젝트 개요

**목표:** PSD 파일을 Figma로 99% 동일하게 변환하는 도구 완성

**현재 상태:** 핵심 파이프라인 동작 중 (PSD → JSON → Figma Plugin Import)
- PSD 파서: ag-psd 30.1.0 기반, 1,383줄
- 변환기: 1,035줄, 13종 이펙트 지원
- Figma 플러그인: 1,211줄, 노드 생성/이미지 로드/폰트 매핑
- 서버: data_server(:4567), comm_server(:4568)
- 테스트 PSD: 30+ 파일, 17개 변환 완료

**기존 산출물:**
- 소스코드: `/src/parser/`, `/src/converter/`, `/src/types/`, `/src/cli/`, `/src/gui/`
- 플러그인: `/figma-plugin/code.ts`, `/figma-plugin/ui.html`
- 빌드: Windows 설치파일 (v1.0.0)
- 출력: `/output/` 하위 17개 디렉토리 (JSON + images)

---

## 2. 99% 정확도를 위한 핵심 갭 분석

### GAP-1: 레이어 마스크 미구현 [심각도: CRITICAL]
- **현재:** `createMaskedNode()`에서 마스크를 완전 무시하고 `[mask ignored]`로 표시
- **영향:** 마스크가 있는 모든 레이어의 외관이 원본과 다름
- **해결방향:** Figma의 마스크 그룹(isMask) 또는 이미지 합성으로 구현

### GAP-2: 폰트 정확도 [심각도: HIGH]
- **현재:** Pretendard, NanumGothic, NotoSansKR 등 모두 → Inter로 대체
- **영향:** 글자 크기, 자간, 줄간이 달라져 텍스트 레이아웃 불일치
- **해결방향:** Figma에 한국어 폰트 설치 확인, 폰트별 메트릭 보정

### GAP-3: 대형 이미지 처리 [심각도: MEDIUM]
- **현재:** 4096px 초과 + 이름에 '배경' 포함 시 흰색 fill로 대체
- **영향:** 배경 이미지가 누락됨
- **해결방향:** 이미지 분할(타일링) 또는 리사이즈 후 import

### GAP-4: 텍스트 위치/변환 정밀도 [심각도: HIGH]
- **현재:** textTransform의 rotation만 적용, scale/translate는 파서에서 fontSize에 반영
- **영향:** 변환된 텍스트나 회전 텍스트의 위치가 어긋날 수 있음
- **해결방향:** 바운딩 박스 기반 위치 보정, Figma 렌더링 차이 보상

### GAP-5: 이펙트 정밀도 [심각도: MEDIUM]
- **현재:** Bevel/Emboss → 데이터만 전달, Figma에서 렌더 안됨. Satin → 미구현. Pattern Overlay → 부분 구현
- **영향:** 복잡한 이펙트가 있는 레이어가 원본과 다름
- **해결방향:** 래스터라이즈 폴백 (이펙트를 이미지로 export하여 사용)

### GAP-6: 시각적 비교/검증 도구 부재 [심각도: CRITICAL]
- **현재:** 정확도를 정량적으로 측정할 방법 없음
- **영향:** "99% 동일"을 판단할 수 없음
- **해결방향:** PSD 래스터라이즈 → Figma export PNG → 픽셀 비교 (SSIM/PSNR)

---

## 3. 제안하는 작업 분해 (WBS 초안)

### Phase 1: 측정 기반 마련 (우선)
- T-001: 시각적 비교 도구 구축 (PSD → PNG vs Figma → PNG, SSIM 점수)
- T-002: 테스트 PSD 선정 및 베이스라인 점수 측정

### Phase 2: 핵심 갭 해결
- T-003: 레이어 마스크 구현
- T-004: 폰트 매핑 개선 (한국어 폰트 지원)
- T-005: 대형 이미지 처리 (리사이즈/타일링)
- T-006: 텍스트 위치 정밀도 개선

### Phase 3: 이펙트 & 폴리싱
- T-007: 미구현 이펙트 래스터라이즈 폴백
- T-008: 클리핑 마스크 정확도 검증 및 개선
- T-009: 전체 테스트 PSD에 대한 99% 달성 확인

### Phase 4: 릴리즈
- T-010: 빌드/실행/배포 문서 업데이트
- T-011: E2E 테스트 자동화

---

## 4. 리스크

| 리스크 | 대응 |
|--------|------|
| Figma Plugin API 제한 (마스크, 이펙트) | 래스터라이즈 폴백으로 우회 |
| 한국어 폰트가 Figma에 없을 수 있음 | 폰트 메트릭 기반 위치 보정 |
| 대형 PSD (2GB+) 메모리 이슈 | 이미 스트리밍 모드 구현됨 |
| 시각적 비교의 "99%" 기준 정의 필요 | SSIM ≥ 0.99 또는 픽셀 차이 ≤ 1% |

---

## 5. 데스크탑 즉시 실행 가능 사항

자비스의 첫 TASK 티켓을 기다리는 동안:
1. comm_server / data_server 정상 가동 확인
2. 기존 변환 결과물 품질 수동 점검
3. 비교 도구 구현을 위한 기술 스파이크

**next_action:** 자비스는 위 GAP 분석과 WBS 초안을 검토하고, 우선순위를 확정한 뒤 첫 번째 TASK 티켓을 발행해주세요.
