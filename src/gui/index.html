<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
  <title>PSD to Figma Converter</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      min-height: 100vh;
      padding: 24px;
      -webkit-app-region: drag;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      -webkit-app-region: no-drag;
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(90deg, #a855f7, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle {
      color: #94a3b8;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .version {
      color: #64748b;
      font-size: 12px;
      margin-bottom: 24px;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      color: #94a3b8;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .file-drop {
      border: 2px dashed rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .file-drop:hover, .file-drop.dragover {
      border-color: #a855f7;
      background: rgba(168, 85, 247, 0.1);
      transform: scale(1.02);
    }

    .file-drop.dragover {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.1);
    }

    .file-drop.dragover .file-drop-icon {
      transform: scale(1.2);
    }

    .file-drop-icon {
      transition: transform 0.3s ease;
    }

    .file-drop-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .file-drop-text {
      color: #94a3b8;
      font-size: 14px;
    }

    .file-drop-hint {
      color: #64748b;
      font-size: 12px;
      margin-top: 8px;
    }

    .file-selected {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: rgba(168, 85, 247, 0.1);
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .file-icon {
      font-size: 32px;
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .file-details {
      font-size: 12px;
      color: #94a3b8;
    }

    .btn-remove {
      background: rgba(239, 68, 68, 0.2);
      border: none;
      color: #ef4444;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
    }

    .output-path {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .output-path input {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 12px 16px;
      color: #fff;
      font-size: 14px;
    }

    .output-path input:focus {
      outline: none;
      border-color: #a855f7;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .btn-primary {
      background: linear-gradient(90deg, #a855f7, #3b82f6);
      color: #fff;
      width: 100%;
      padding: 16px;
      font-size: 16px;
    }

    .btn-primary:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .layer-tree {
      max-height: 200px;
      overflow-y: auto;
      font-size: 12px;
      font-family: 'Monaco', 'Menlo', monospace;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 12px;
    }

    .layer-item {
      padding: 4px 0;
      color: #94a3b8;
    }

    .layer-type {
      color: #a855f7;
      margin-right: 8px;
    }

    .layer-size {
      color: #64748b;
      margin-left: 8px;
    }

    .result {
      display: none;
    }

    .result.show {
      display: block;
    }

    .result-success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .result-title {
      color: #22c55e;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .result-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .stat {
      text-align: center;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #fff;
    }

    .stat-label {
      font-size: 11px;
      color: #94a3b8;
      margin-top: 4px;
    }

    .result-extra {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .result-extra-item {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
    }

    body.light-theme .result-extra {
      border-color: rgba(0, 0, 0, 0.1);
    }

    .result-actions {
      display: flex;
      gap: 12px;
    }

    .result-actions .btn {
      flex: 1;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 40px;
    }

    .loading.show {
      display: block;
    }

    .progress-container {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #a855f7, #3b82f6);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .progress-text {
      color: #94a3b8;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .progress-percent {
      color: #fff;
      font-size: 24px;
      font-weight: 700;
    }

    .hidden {
      display: none !important;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 32px;
    }

    .header-buttons {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .icon-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .theme-toggle {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(20deg);
    }

    /* ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: #1a1a2e;
      border-radius: 16px;
      padding: 24px;
      max-width: 400px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-content h3 {
      font-size: 14px;
      color: #a855f7;
      margin-bottom: 12px;
      margin-top: 16px;
    }

    .modal-content h3:first-child {
      margin-top: 0;
    }

    .shortcut-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .shortcut-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    kbd {
      background: rgba(255, 255, 255, 0.1);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-family: monospace;
    }

    .feature-list {
      list-style: none;
      font-size: 13px;
      line-height: 1.8;
    }

    body.light-theme .modal-content {
      background: #fff;
    }

    body.light-theme kbd {
      background: rgba(0, 0, 0, 0.1);
    }

    /* ë¼ì´íŠ¸ í…Œë§ˆ */
    body.light-theme {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
      color: #1a1a2e;
    }

    body.light-theme .card {
      background: rgba(255, 255, 255, 0.8);
      border-color: rgba(0, 0, 0, 0.1);
    }

    body.light-theme .subtitle {
      color: #64748b;
    }

    body.light-theme .card-title {
      color: #64748b;
    }

    body.light-theme .file-drop {
      border-color: rgba(0, 0, 0, 0.2);
    }

    body.light-theme .file-drop-text {
      color: #64748b;
    }

    body.light-theme .output-path input {
      background: rgba(0, 0, 0, 0.05);
      border-color: rgba(0, 0, 0, 0.1);
      color: #1a1a2e;
    }

    body.light-theme .layer-tree {
      background: rgba(0, 0, 0, 0.05);
    }

    body.light-theme .layer-item {
      color: #64748b;
    }

    body.light-theme .theme-toggle {
      background: rgba(0, 0, 0, 0.1);
    }

    body.light-theme h1 {
      background: linear-gradient(90deg, #7c3aed, #2563eb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* ì• ë‹ˆë©”ì´ì…˜ */
    .card {
      animation: fadeInUp 0.5s ease;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-success {
      animation: scaleIn 0.3s ease;
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Figma ì•ˆë‚´ */
    .figma-guide {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
    }

    .guide-title {
      font-weight: 600;
      margin-bottom: 12px;
      color: #3b82f6;
    }

    .guide-steps {
      margin: 0;
      padding-left: 20px;
      font-size: 13px;
      line-height: 1.8;
    }

    .guide-steps li {
      margin-bottom: 4px;
    }

    .guide-steps code {
      background: rgba(255, 255, 255, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
    }

    .guide-note {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(59, 130, 246, 0.2);
      font-size: 12px;
      color: #94a3b8;
    }

    body.light-theme .figma-guide {
      background: rgba(59, 130, 246, 0.05);
    }

    body.light-theme .guide-steps code {
      background: rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>PSD/PSB to Figma</h1>
        <p class="subtitle">í¬í† ìƒµ íŒŒì¼(PSD/PSB)ì„ Figmaë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ë ˆì´ì–´ êµ¬ì¡°ê°€ ìœ ì§€ë©ë‹ˆë‹¤.</p>
        <p class="version" id="appVersion"></p>
      </div>
    </div>

    <!-- íŒŒì¼ ì„ íƒ -->
    <div class="card" id="fileCard">
      <div class="card-title">1. PSD/PSB íŒŒì¼ ì„ íƒ</div>

      <div id="fileDrop" class="file-drop">
        <div class="file-drop-icon">ğŸ“</div>
        <div class="file-drop-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
        <div class="file-drop-hint">PSD, PSB íŒŒì¼ ì§€ì›</div>
      </div>

      <div id="fileSelected" class="file-selected hidden">
        <div class="file-icon">ğŸ¨</div>
        <div class="file-info">
          <div class="file-name" id="fileName"></div>
          <div class="file-details" id="fileDetails"></div>
        </div>
        <button class="btn-remove" id="btnRemove">ì œê±°</button>
      </div>
    </div>

    <!-- ë ˆì´ì–´ ë¯¸ë¦¬ë³´ê¸° -->
    <div class="card hidden" id="layerCard">
      <div class="card-title">2. ë ˆì´ì–´ êµ¬ì¡°</div>
      <div class="layer-tree" id="layerTree"></div>
    </div>

    <!-- ì¶œë ¥ ê²½ë¡œ -->
    <div class="card hidden" id="outputCard">
      <div class="card-title">3. ì¶œë ¥ í´ë”</div>
      <div class="output-path">
        <input type="text" id="outputPath" placeholder="ì¶œë ¥ í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”" readonly>
        <button class="btn btn-secondary" id="btnSelectOutput">ì„ íƒ</button>
      </div>
    </div>

    <!-- ë³€í™˜ ë²„íŠ¼ -->
    <button class="btn btn-primary hidden" id="btnConvert" disabled>
      Figmaë¡œ ë³€í™˜í•˜ê¸°
    </button>

    <!-- ë¡œë”© -->
    <div class="loading" id="loading">
      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="progress-text" id="progressText">ì¤€ë¹„ ì¤‘...</div>
      <div class="progress-percent" id="progressPercent">0%</div>
    </div>

    <!-- ê²°ê³¼ -->
    <div class="result" id="result">
      <div class="result-success">
        <div class="result-title">âœ… ë³€í™˜ ì™„ë£Œ!</div>
        <div class="result-stats">
          <div class="stat">
            <div class="stat-value" id="statTotal">0</div>
            <div class="stat-label">ì „ì²´ ë ˆì´ì–´</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="statGroups">0</div>
            <div class="stat-label">ê·¸ë£¹</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="statText">0</div>
            <div class="stat-label">í…ìŠ¤íŠ¸</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="statImages">0</div>
            <div class="stat-label">ì´ë¯¸ì§€</div>
          </div>
        </div>
        <div class="result-extra" id="resultExtra"></div>
      </div>

      <!-- Figma ì‚¬ìš© ì•ˆë‚´ -->
      <div class="figma-guide">
        <div class="guide-title">ğŸ“Œ Figmaì—ì„œ ê°€ì ¸ì˜¤ê¸°</div>
        <ol class="guide-steps">
          <li><strong>Figma ì—´ê¸°</strong> â†’ ìƒˆ íŒŒì¼ ë˜ëŠ” ê¸°ì¡´ íŒŒì¼</li>
          <li><strong>Plugins</strong> â†’ <strong>Development</strong> â†’ <strong>Import plugin from manifest</strong></li>
          <li><code>figma-plugin/manifest.json</code> íŒŒì¼ ì„ íƒ</li>
          <li><strong>Plugins</strong> â†’ <strong>Development</strong> â†’ <strong>PSD to Figma Import</strong> ì‹¤í–‰</li>
          <li><strong>output í´ë” ì„ íƒ</strong> (ë³€í™˜ëœ JSON + images í´ë”)</li>
          <li><strong>Import</strong> ë²„íŠ¼ í´ë¦­</li>
        </ol>
        <div class="guide-note">
          ğŸ’¡ í”ŒëŸ¬ê·¸ì¸ì´ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìœ¼ë©´ 3ë²ˆë¶€í„° ì§„í–‰í•˜ì„¸ìš”.
        </div>
      </div>

      <div class="result-actions">
        <button class="btn btn-secondary" id="btnOpenFolder">í´ë” ì—´ê¸°</button>
        <button class="btn btn-primary" id="btnNewConvert">ìƒˆ íŒŒì¼ ë³€í™˜</button>
      </div>
    </div>
  </div>

  <script>
    let selectedFile = null;
    let outputDir = null;
    let psdData = null;
    let convertedJsonPath = null;

    // ì•± ë²„ì „ í‘œì‹œ
    (async () => {
      const version = await window.electronAPI.getAppVersion();
      document.getElementById('appVersion').textContent = `v${version}`;
    })();

    // ìš”ì†Œë“¤
    const fileDrop = document.getElementById('fileDrop');
    const fileSelected = document.getElementById('fileSelected');
    const fileName = document.getElementById('fileName');
    const fileDetails = document.getElementById('fileDetails');
    const btnRemove = document.getElementById('btnRemove');
    const layerCard = document.getElementById('layerCard');
    const layerTree = document.getElementById('layerTree');
    const outputCard = document.getElementById('outputCard');
    const outputPath = document.getElementById('outputPath');
    const btnSelectOutput = document.getElementById('btnSelectOutput');
    const btnConvert = document.getElementById('btnConvert');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');

    // íŒŒì¼ ì„ íƒ (í´ë¦­)
    fileDrop.addEventListener('click', async () => {
      const path = await window.electronAPI.selectPsdFile();
      if (path) {
        await selectFile(path);
      }
    });

    // ë“œë˜ê·¸ì•¤ë“œë¡­
    fileDrop.addEventListener('dragover', (e) => {
      e.preventDefault();
      e.stopPropagation();
      fileDrop.classList.add('dragover');
    });

    fileDrop.addEventListener('dragleave', (e) => {
      e.preventDefault();
      e.stopPropagation();
      fileDrop.classList.remove('dragover');
    });

    fileDrop.addEventListener('drop', async (e) => {
      e.preventDefault();
      e.stopPropagation();
      fileDrop.classList.remove('dragover');

      const files = e.dataTransfer.files;
      if (files.length > 0) {
        const file = files[0];
        const ext = file.name.toLowerCase();
        if (ext.endsWith('.psd') || ext.endsWith('.psb')) {
          // Electronì˜ webUtils APIë¡œ íŒŒì¼ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
          const filePath = window.electronAPI.getPathForFile(file);
          await selectFile(filePath);
        } else {
          alert('PSD ë˜ëŠ” PSB íŒŒì¼ë§Œ ì§€ì›í•©ë‹ˆë‹¤.');
        }
      }
    });

    // ì „ì—­ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ë°©ì§€
    document.addEventListener('dragover', (e) => e.preventDefault());
    document.addEventListener('drop', (e) => e.preventDefault());

    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
    document.addEventListener('keydown', async (e) => {
      // Ctrl+O: íŒŒì¼ ì—´ê¸°
      if (e.ctrlKey && e.key === 'o') {
        e.preventDefault();
        const path = await window.electronAPI.selectPsdFile();
        if (path) await selectFile(path);
      }
      // Ctrl+Enter: ë³€í™˜
      if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        if (!btnConvert.disabled) btnConvert.click();
      }
      // Escape: ì´ˆê¸°í™”
      if (e.key === 'Escape') {
        resetUI();
      }
    });


    // íŒŒì¼ ì œê±°
    btnRemove.addEventListener('click', () => {
      resetUI();
    });

    // ì¶œë ¥ í´ë” ì„ íƒ
    btnSelectOutput.addEventListener('click', async () => {
      const path = await window.electronAPI.selectOutputFolder();
      if (path) {
        outputDir = path;
        outputPath.value = path;
        updateConvertButton();
      }
    });

    // í”„ë¡œê·¸ë˜ìŠ¤ë°” ìš”ì†Œ
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const progressPercent = document.getElementById('progressPercent');

    // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ
    window.electronAPI.onProgress((progress) => {
      progressBar.style.width = progress.percent + '%';
      progressText.textContent = progress.message;
      progressPercent.textContent = progress.percent + '%';
    });

    // ë³€í™˜ ë²„íŠ¼
    btnConvert.addEventListener('click', async () => {
      if (!selectedFile || !outputDir) return;

      // CLI ëª¨ë“œ í™•ì¸ (2GB+ íŒŒì¼)
      if (btnConvert.dataset.useCli === 'true') {
        const result = await window.electronAPI.runCliConvert(selectedFile, outputDir);
        if (result.success) {
          alert('CLIê°€ ìƒˆ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní„°ë¯¸ë„ì—ì„œ ë³€í™˜ ì™„ë£Œ í›„ Figmaì—ì„œ import í•˜ì„¸ìš”.');
        } else {
          alert('CLI ì‹¤í–‰ ì‹¤íŒ¨: ' + result.error);
        }
        return;
      }

      // ì¼ë°˜ ë³€í™˜
      progressBar.style.width = '0%';
      progressText.textContent = 'ì¤€ë¹„ ì¤‘...';
      progressPercent.textContent = '0%';

      showLoading(true);

      const result = await window.electronAPI.convertPsd(selectedFile, outputDir);

      showLoading(false);

      if (result.success) {
        showResult(result.data);
      } else {
        alert('ë³€í™˜ ì‹¤íŒ¨: ' + result.error);
      }
    });

    // í´ë” ì—´ê¸°
    document.getElementById('btnOpenFolder').addEventListener('click', () => {
      if (outputDir) {
        window.electronAPI.openFolder(outputDir);
      }
    });

    // ìƒˆ íŒŒì¼ ë³€í™˜
    document.getElementById('btnNewConvert').addEventListener('click', () => {
      resetUI();
    });

    async function selectFile(path) {
      selectedFile = path;

      // í”„ë¡œê·¸ë˜ìŠ¤ë°” ì´ˆê¸°í™” ë° í‘œì‹œ
      progressBar.style.width = '0%';
      progressText.textContent = 'íŒŒì¼ ë¶„ì„ ì¤‘...';
      progressPercent.textContent = '0%';
      showLoading(true);

      // ë¶„ì„
      const result = await window.electronAPI.analyzePsd(path);

      showLoading(false);

      if (!result.success) {
        alert('íŒŒì¼ ë¶„ì„ ì‹¤íŒ¨: ' + result.error);
        return;
      }

      psdData = result.data;

      // UI ì—…ë°ì´íŠ¸
      fileDrop.classList.add('hidden');
      fileSelected.classList.remove('hidden');
      const ext = path.toLowerCase().endsWith('.psb') ? '.psb' : '.psd';
      fileName.textContent = psdData.name + ext;

      // ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—¬ë¶€ í™•ì¸
      if (psdData.isTooLarge) {
        // ì´ˆëŒ€ìš©ëŸ‰ íŒŒì¼ (2GB+): CLIë¡œ ì‹¤í–‰
        fileDetails.innerHTML = `âš ï¸ <strong>${(psdData.fileSizeMB / 1024).toFixed(1)}GB</strong> - ë³„ë„ í„°ë¯¸ë„ì—ì„œ CLIë¡œ ë³€í™˜ë©ë‹ˆë‹¤`;

        // ë ˆì´ì–´ íŠ¸ë¦¬ ìˆ¨ê¹€, ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        layerCard.classList.add('hidden');
        btnConvert.disabled = false;
        btnConvert.textContent = 'ğŸ–¥ï¸ CLIë¡œ ë³€í™˜ (í„°ë¯¸ë„ ì—´ê¸°)';
        btnConvert.dataset.useCli = 'true';
      } else if (psdData.isLargeFile) {
        // ëŒ€ìš©ëŸ‰ íŒŒì¼ (500MB~2GB): ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œ
        fileDetails.textContent = `ğŸ“¦ ${psdData.fileSizeMB}MB - ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œë¡œ ë³€í™˜ë©ë‹ˆë‹¤`;

        // ë ˆì´ì–´ íŠ¸ë¦¬ ìˆ¨ê¹€
        layerCard.classList.add('hidden');
      } else {
        // ì¼ë°˜ íŒŒì¼: ìƒì„¸ ì •ë³´ í‘œì‹œ
        let details = `${psdData.width} x ${psdData.height}px Â· ${psdData.layerCount} layers`;
        if (psdData.resolution) {
          details += ` Â· ${psdData.resolution.horizontal} ${psdData.resolution.horizontalUnit}`;
        }
        if (psdData.guides && psdData.guides.length > 0) {
          details += ` Â· ${psdData.guides.length} guides`;
        }
        fileDetails.textContent = details;

        // ë ˆì´ì–´ íŠ¸ë¦¬ í‘œì‹œ
        layerCard.classList.remove('hidden');
        layerTree.innerHTML = renderLayerTree(psdData.layers);
      }

      // ì¶œë ¥ ì„¤ì • í‘œì‹œ
      outputCard.classList.remove('hidden');
      btnConvert.classList.remove('hidden');

      // ê¸°ë³¸ ì¶œë ¥ ê²½ë¡œ ì„¤ì • (í¬ë¡œìŠ¤ í”Œë«í¼)
      const dir = await window.electronAPI.getDirname(path);
      outputDir = await window.electronAPI.joinPath(dir, 'output');
      outputPath.value = outputDir;

      updateConvertButton();
    }

    function renderLayerTree(layers, indent = 0) {
      let html = '';
      for (const layer of layers) {
        const prefix = '  '.repeat(indent);
        const typeLabel = {
          'group': 'ğŸ“',
          'text': 'ğŸ“',
          'layer': 'ğŸ–¼ï¸',
          'shape': 'â¬¡',
          'adjustment': 'ğŸšï¸'
        }[layer.type] || 'â—»ï¸';

        // íƒœê·¸ ìƒì„±
        let tags = [];
        if (layer.effects) tags.push('fx');
        if (layer.clipping) tags.push('clip');
        if (layer.mask) tags.push('mask');
        if (layer.vectorMask) tags.push('vmask');
        if (layer.vectorStroke) tags.push('stroke');
        if (layer.placedLayer) tags.push('placed');
        if (layer.smartFilters) tags.push('filter');
        const tagStr = tags.length > 0 ? ` <span style="color:#a855f7;font-size:10px">[${tags.join(' ')}]</span>` : '';

        html += `<div class="layer-item">${prefix}<span class="layer-type">${typeLabel}</span>${layer.name}<span class="layer-size">${layer.bounds.width}x${layer.bounds.height}</span>${tagStr}</div>`;

        if (layer.children) {
          html += renderLayerTree(layer.children, indent + 1);
        }
      }
      return html;
    }

    function updateConvertButton() {
      btnConvert.disabled = !selectedFile || !outputDir;
    }

    function showLoading(show) {
      loading.classList.toggle('show', show);
      btnConvert.classList.toggle('hidden', show);
    }

    function showResult(data) {
      document.getElementById('fileCard').classList.add('hidden');
      layerCard.classList.add('hidden');
      outputCard.classList.add('hidden');
      btnConvert.classList.add('hidden');

      // CLI ëª¨ë“œ ê²°ê³¼ (summary.messageê°€ ìˆëŠ” ê²½ìš°)
      if (data.summary && data.summary.message) {
        document.getElementById('statTotal').textContent = '-';
        document.getElementById('statGroups').textContent = '-';
        document.getElementById('statText').textContent = '-';
        document.getElementById('statImages').textContent = '-';

        let extraHtml = `<div class="result-extra-item"><span>ì²˜ë¦¬ ë°©ì‹</span><span>CLI í”„ë¡œì„¸ìŠ¤</span></div>`;
        if (data.files && data.files.length > 0) {
          extraHtml += `<div class="result-extra-item"><span>ì¶œë ¥ íŒŒì¼</span><span>${data.files.length}ê°œ</span></div>`;
        }
        extraHtml += `<div class="result-extra-item"><span>ìƒíƒœ</span><span>${data.summary.message}</span></div>`;
        document.getElementById('resultExtra').innerHTML = extraHtml;
      } else {
        // ì¼ë°˜ ëª¨ë“œ ê²°ê³¼
        document.getElementById('statTotal').textContent = data.summary.totalLayers || 0;
        document.getElementById('statGroups').textContent = data.summary.groups || 0;
        document.getElementById('statText').textContent = data.summary.textLayers || 0;
        document.getElementById('statImages').textContent = data.summary.imageLayers || 0;

        // ì¶”ê°€ ì •ë³´ í‘œì‹œ
        let extraHtml = '';
        if (data.summary.shapeLayers > 0) {
          extraHtml += `<div class="result-extra-item"><span>ë„í˜• ë ˆì´ì–´</span><span>${data.summary.shapeLayers}</span></div>`;
        }
        if (data.summary.adjustmentLayers > 0) {
          extraHtml += `<div class="result-extra-item"><span>ì¡°ì • ë ˆì´ì–´</span><span>${data.summary.adjustmentLayers}</span></div>`;
        }
        if (data.summary.smartFilterLayers > 0) {
          extraHtml += `<div class="result-extra-item"><span>ìŠ¤ë§ˆíŠ¸ í•„í„°</span><span>${data.summary.smartFilterLayers}</span></div>`;
        }
        if (data.files && data.files.length > 0) {
          extraHtml += `<div class="result-extra-item"><span>ì¶œë ¥ íŒŒì¼</span><span>${data.files.length}ê°œ</span></div>`;
        }
        document.getElementById('resultExtra').innerHTML = extraHtml;
      }

      // ì¶œë ¥ í´ë” ì—…ë°ì´íŠ¸
      if (data.outputDir) {
        outputDir = data.outputDir;
      }

      convertedJsonPath = data.jsonPath;
      result.classList.add('show');
    }

    function resetUI() {
      selectedFile = null;
      outputDir = null;
      psdData = null;

      fileDrop.classList.remove('hidden');
      fileSelected.classList.add('hidden');
      layerCard.classList.add('hidden');
      outputCard.classList.add('hidden');
      btnConvert.classList.add('hidden');
      btnConvert.textContent = 'Figmaë¡œ ë³€í™˜í•˜ê¸°';
      btnConvert.disabled = false;
      btnConvert.dataset.useCli = '';
      result.classList.remove('show');
      document.getElementById('fileCard').classList.remove('hidden');
    }
  </script>
</body>
</html>
